# -*- coding: utf-8 -*-
"""churn_dashboard.py

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1wmyvSHdnD6k3pOjKHTDg2Ft-ebHtDRo6
"""

import streamlit as st
import pandas as pd
import matplotlib.pyplot as plt

st.set_page_config(page_title="–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –æ—Ç—Ç–æ–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤", layout="wide")

st.title("üìâ –ü—Ä–æ–≥–Ω–æ–∑ –æ—Ç—Ç–æ–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤")
# –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –≤–∫–ª–∞–¥–∫–∞–º
tab1, tab2 = st.tabs(["üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –æ—Ç—Ç–æ–∫–∞", "üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–¥–µ—Ä–∂–∞–Ω–∏—é"])

st.markdown("–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –¥–∞—à–±–æ—Ä–¥ –ø–æ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ —É—Ö–æ–¥–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤")

# === –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö ===
uploaded_file = st.file_uploader("üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç–µ CSV —Å –¥–∞–Ω–Ω—ã–º–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤", type=["csv"])

with tab1:
    if uploaded_file:
    df = pd.read_csv(uploaded_file)

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –Ω—É–∂–Ω—ã—Ö –∫–æ–ª–æ–Ω–æ–∫
    if "–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å_–æ—Ç—Ç–æ–∫–∞" not in df.columns:
        st.error("‚ö†Ô∏è –í —Ñ–∞–π–ª–µ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∫–æ–ª–æ–Ω–∫–∞ '–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å_–æ—Ç—Ç–æ–∫–∞'")
    else:
        # === –§–∏–ª—å—Ç—Ä –ø–æ —Å–µ–≥–º–µ–Ω—Ç—É ===
        segment = st.selectbox("–í—ã–±–µ—Ä–∏—Ç–µ —Å–µ–≥–º–µ–Ω—Ç —Ä–∏—Å–∫–∞", ["–í—Å–µ", "–ù–∞–¥—ë–∂–Ω—ã–π", "–ì—Ä—É–ø–ø–∞ —Ä–∏—Å–∫–∞", "–í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫"])

        if segment != "–í—Å–µ":
            df = df[df["–°–µ–≥–º–µ–Ω—Ç"] == segment]

        # === –ú–µ—Ç—Ä–∏–∫–∏ ===
        avg_prob = df["–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å_–æ—Ç—Ç–æ–∫–∞"].mean()
        high_risk = (df["–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å_–æ—Ç—Ç–æ–∫–∞"] > 0.6).mean() * 100

        col1, col2 = st.columns(2)
        col1.metric("–°—Ä–µ–¥–Ω—è—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —É—Ö–æ–¥–∞", f"{avg_prob:.2f}")
        col2.metric("–î–æ–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å –≤—ã—Å–æ–∫–∏–º —Ä–∏—Å–∫–æ–º", f"{high_risk:.1f}%")

        # === –ì–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ ===
        fig, ax = plt.subplots(figsize=(7,4))
        ax.hist(df["–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å_–æ—Ç—Ç–æ–∫–∞"], bins=10, color="coral", edgecolor="black")
        ax.set_title("–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –æ—Ç—Ç–æ–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤")
        ax.set_xlabel("–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —É—Ö–æ–¥–∞")
        ax.set_ylabel("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∏–µ–Ω—Ç–æ–≤")
        st.pyplot(fig)

        # === –¢–∞–±–ª–∏—Ü–∞ ===
        st.subheader("üîù –¢–æ–ø –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å –≤—ã—Å–æ–∫–∏–º —Ä–∏—Å–∫–æ–º —É—Ö–æ–¥–∞")
        st.dataframe(df.sort_values("–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å_–æ—Ç—Ç–æ–∫–∞", ascending=False).head(15))
else:
    st.info("üëÜ –ó–∞–≥—Ä—É–∑–∏—Ç–µ CSV-—Ñ–∞–π–ª —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –ø—Ä–æ–≥–Ω–æ–∑–∞ (–≤–∫–ª—é—á–∞—è '–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å_–æ—Ç—Ç–æ–∫–∞' –∏ '–°–µ–≥–º–µ–Ω—Ç').")
